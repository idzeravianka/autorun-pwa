"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9844],{9844:(q,m,s)=>{s.r(m),s.d(m,{SettingsModule:()=>J});var a=s(6814),u=s(95),l=s(3800),t=s(5678);let v=(()=>{var n;class i{}return(n=i).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[a.ez]}),i})();var p=s(974),f=s(5861),h=s(7715),C=s(8180),g=s(9795),x=s(7921),T=s(2181),S=s(4664),d=s(2096),M=s(9773),y=s(5399);const A={pattern:"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442",required:"\u041f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f"};let F=(()=>{var n;class i extends y.X{transform(e,r){return r.statusChanges.pipe((0,x.O)(r.status),(0,T.h)(c=>"INVALID"===c),(0,S.w)(()=>{if(!r.pristine&&!r.errors)return(0,d.of)("");const c=r.errors&&Object.keys(r.errors)[0]||"";return(0,d.of)(A[e?`${e}-${c}`:c]||"")}),(0,M.R)(this.destroyedSource))}}return(n=i).\u0275fac=(()=>{let o;return function(r){return(o||(o=t.n5z(n)))(r||n)}})(),n.\u0275pipe=t.Yjl({name:"getErrorText",type:n,pure:!0}),i})();function Z(n,i){if(1&n){const o=t.EpF();t.TgZ(0,"div",1)(1,"div",2),t._uU(2,"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"),t.qZA(),t.TgZ(3,"ion-list",3),t._UZ(4,"ion-input",4),t.ALo(5,"async"),t.ALo(6,"getErrorText"),t._UZ(7,"ion-input",5),t.ALo(8,"async"),t.ALo(9,"getErrorText"),t._UZ(10,"ion-input",6),t.ALo(11,"async"),t.ALo(12,"getErrorText"),t._UZ(13,"ion-input",7),t.ALo(14,"async"),t.ALo(15,"getErrorText"),t._UZ(16,"ion-input",8),t.ALo(17,"async"),t.ALo(18,"getErrorText"),t.qZA(),t.TgZ(19,"div",3)(20,"ion-button",9),t.NdJ("click",function(){t.CHM(o);const r=t.oxw();return t.KtG(r.showConfirmationDialog())}),t._uU(21,"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c"),t.qZA(),t.TgZ(22,"ion-button",10),t.NdJ("click",function(){t.CHM(o);const r=t.oxw();return t.KtG(r.saveSettings())}),t._uU(23,"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),t.qZA()(),t.TgZ(24,"div",11),t._uU(25," \u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0443\u0435\u043c\u044b\u0435 MQTT \u0441\u0435\u0440\u0432\u0435\u0440\u0430: wqtt.ru, clusterfly.ru, cloudmqtt.com. "),t.qZA()()}if(2&n){const o=t.oxw();t.Q6J("formGroup",o.settingsForm),t.xp6(4),t.Q6J("errorText",t.lcZ(5,6,t.xi3(6,8,"",o.settingsForm.controls.server))),t.xp6(3),t.Q6J("errorText",t.lcZ(8,11,t.xi3(9,13,"",o.settingsForm.controls.port))),t.xp6(3),t.Q6J("errorText",t.lcZ(11,16,t.xi3(12,18,"",o.settingsForm.controls.user))),t.xp6(3),t.Q6J("errorText",t.lcZ(14,21,t.xi3(15,23,"",o.settingsForm.controls.pass))),t.xp6(3),t.Q6J("errorText",t.lcZ(17,26,t.xi3(18,28,"",o.settingsForm.controls.topic)))}}let E=(()=>{var n;class i{constructor(e,r){this.mqttService=e,this.actionSheetCtrl=r}ngOnInit(){this.initSettingsForm()}saveSettings(){this.settingsForm.markAllAsTouched(),this.settingsForm.invalid||this.mqttService.saveMqttSettings(this.settingsForm.value)}showConfirmationDialog(){var e=this;return(0,f.Z)(function*(){const r=yield e.actionSheetCtrl.create({header:"\u0412\u044b \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f?",buttons:[{text:"\u0414\u0430",role:"confirm"},{text:"\u041d\u0435\u0442",role:"cancel"}]});yield r.present(),(0,h.D)(r.onWillDismiss()).pipe((0,C.q)(1)).subscribe(({role:c})=>{"confirm"===c&&e.resetForm()})})()}resetForm(){this.mqttService.clearMqttConnectionSettings(),this.settingsForm.reset()}initSettingsForm(){const e=this.mqttService.getMqttSavedSettings()?JSON.parse(this.mqttService.getMqttSavedSettings()):null;this.settingsForm=new u.cw({server:new u.NI((null==e?void 0:e.server)||null,[u.kI.required,u.kI.pattern("^[a-zA-Z\\.0-9]+$")]),port:new u.NI((null==e?void 0:e.port)||null,[u.kI.required,u.kI.pattern("[0-9]{0,10}")]),user:new u.NI((null==e?void 0:e.user)||null,[u.kI.required]),pass:new u.NI((null==e?void 0:e.pass)||null,[u.kI.required]),topic:new u.NI((null==e?void 0:e.topic)||null,[u.kI.required])})}}return(n=i).\u0275fac=function(e){return new(e||n)(t.Y36(g.K),t.Y36(l.BX))},n.\u0275cmp=t.Xpm({type:n,selectors:[["az-connection"]],decls:2,vars:1,consts:[["class","settings",3,"formGroup",4,"ngIf"],[1,"settings",3,"formGroup"],[1,"settings__title"],[1,"settings__field"],["formControlName","server","placeholder","srv2.clusterfly.ru","label","\u0421\u0435\u0440\u0432\u0435\u0440 (MQTT broker):","labelPlacement","floating",3,"errorText"],["formControlName","port","placeholder","9994","label","\u041f\u043e\u0440\u0442 (MQTT port):","labelPlacement","floating",3,"errorText"],["formControlName","user","placeholder","user","label","\u041b\u043e\u0433\u0438\u043d (MQTT user):","labelPlacement","floating",3,"errorText"],["type","password","formControlName","pass","placeholder","qwerty","label","\u041f\u0430\u0440\u043e\u043b\u044c (MQTT password):","labelPlacement","floating",3,"errorText"],["formControlName","topic","placeholder","user_12345678/c5","label","\u041f\u0440\u0435\u0444\u0438\u043a\u0441 \u0442\u043e\u043f\u0438\u043a\u0430 (prefix):","labelPlacement","floating",3,"errorText"],["fill","outline",1,"settings__button",3,"click"],[1,"settings__button",3,"click"],[1,"settings__prompt"]],template:function(e,r){1&e&&(t.TgZ(0,"ion-content"),t.YNc(1,Z,26,31,"div",0),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",!!r.settingsForm))},dependencies:[a.O5,u.JJ,u.JL,u.sg,u.u,l.YG,l.W2,l.pK,l.q_,l.j9,a.Ov,F],styles:[".settings[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.settings__title[_ngcontent-%COMP%]{padding:15px 0;font-size:16px;font-weight:700}.settings__field[_ngcontent-%COMP%]{width:80%;max-width:350px;margin-bottom:15px}.settings__button[_ngcontent-%COMP%]{width:46%}.settings__button[_ngcontent-%COMP%]:first-child{margin-right:2%}.settings__button[_ngcontent-%COMP%]:last-child{margin-left:2%}.settings__prompt[_ngcontent-%COMP%]{width:80%;max-width:350px;margin-top:15px;color:rgba(0,0,0,.54);text-align:center}"]}),i})();var b=s(8996),w=s(5472);const _=[{path:"",component:(()=>{var n;class i{}return(n=i).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["az-settings"]],decls:2,vars:0,template:function(e,r){1&e&&(t.TgZ(0,"ion-content"),t._UZ(1,"ion-router-outlet"),t.qZA())},dependencies:[l.W2,l.jP]}),i})(),children:[{path:"",component:(()=>{var n;class i{constructor(e,r,c){this.mqttService=e,this.navController=r,this.window=c,this.hasInternetConnection$=this.mqttService.hasInternetConnection$,this.version$=this.mqttService.version$}navigateTo(e){this.navController.navigateForward(e)}openTelegram(){this.window.open("https://t.me/+Vw4C60B8Yqob_JWc","_blank")}}return(n=i).\u0275fac=function(e){return new(e||n)(t.Y36(g.K),t.Y36(w.SH),t.Y36(b.I))},n.\u0275cmp=t.Xpm({type:n,selectors:[["az-menu"]],decls:9,vars:6,consts:[[1,"settings-menu"],[1,"settings-menu__button",3,"disabled","click"],[1,"version"]],template:function(e,r){1&e&&(t.TgZ(0,"div",0)(1,"ion-button",1),t.NdJ("click",function(){return r.navigateTo("settings/connection")}),t.ALo(2,"async"),t._uU(3," \u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 "),t.qZA(),t.TgZ(4,"ion-button",1),t.NdJ("click",function(){return r.openTelegram()}),t.ALo(5,"async"),t._uU(6," \u0422\u0435\u043b\u0435\u0433\u0440\u0430\u043c "),t.qZA(),t.TgZ(7,"div",2),t._uU(8,"\u0412\u0435\u0440\u0441\u0438\u044f \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f: 0.0.1"),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("disabled",!t.lcZ(2,2,r.hasInternetConnection$)),t.xp6(3),t.Q6J("disabled",!t.lcZ(5,4,r.hasInternetConnection$)))},dependencies:[l.YG,a.Ov],styles:[".settings-menu[_ngcontent-%COMP%]{display:flex;flex-flow:column nowrap;justify-content:center;align-items:center;row-gap:10px;height:calc(100vh - 48px);padding:15px}.settings-menu__button[_ngcontent-%COMP%]{width:90%}.version[_ngcontent-%COMP%]{width:100%;font-size:16px;color:rgba(0,0,0,.54);position:absolute;bottom:0;text-align:center;margin-bottom:15px}"]}),i})(),pathMatch:"full"},{path:"connection",component:E}]}];let I=(()=>{var n;class i{}return(n=i).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.Bz.forChild(_),p.Bz]}),i})(),J=(()=>{var n;class i{}return(n=i).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[a.ez,I,u.UX,u.u5,l.Pc,v]}),i})()}}]);